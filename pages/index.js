import Head from 'next/head'
import Layout from '../components/layout'
import Header from '../components/header'
import Sidebar from '../components/sidebar'
import Main from '../components/main'
import Footer from '../components/footer'
import { useEffect } from 'react'
import getStreams from '../functions/get-streams'
import { useState } from 'react'
import getInfoUsers from '../functions/get-info-users'


export default function Home() {
  let [ streams, setStreams ] = useState(null)
  let [ userData, setUserData ] = useState(null)

  useEffect(() => { 
    getStreams().then(res => setStreams(res))
    
  }, [])

  useEffect(() => {
    if(streams){
      getInfoUsers(streams.data).then( res => setUserData(res))
    }
  }, [streams])

  return (
    <Layout>
      <Head>
        <title>The Best Streaming</title>
        <meta name="description" content="Generated by create next app" />
      </Head>

      <Header />
      <Sidebar
        streams={streams ? streams.data : null}
        userData={userData ? userData.data : null} 
      />
      <Main 
        streams={streams ? streams.data : null}
        userData={userData ? userData.data : null} />
      <Footer />
    </Layout>
  )
}
